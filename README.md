# Shadow Dex (シークレット辞書アプリ)

新社会人や新しいチームにジョインした人が、**社内のローカルルール・飛び交うビジネス用語・先輩社員の名前と特徴などをこっそりメモし、後から爆速で検索・振り返りができる**個人的なデータベースアプリです。

## ✨ 主な特徴・機能

1. **完全ローカル・セキュア設計**
   外部のサーバーや自前のデータベース（Firebase/Supabaseなど）には一切データが送信されません。すべてブラウザの `IndexedDB` にローカルデータとして保存されるため、社内秘の情報や個人的なメモも安心して書き込めます。
2. **NotionライクなクリーンUI ＆ モバイル最適化**
   シンプルでタイポグラフィを重視したデザイン。業務中にこっそり開いても目立ちません。スマホブラウザからの利用にも対応したレスポンシブなビューを提供します。
3. **爆速のリアルタイム検索**
   タイトル、詳細メモ、カテゴリ、タグから部分一致で瞬間的にエントリを検索可能です。
4. **柔軟なカテゴリ・アイコン管理**
   デフォルトのカテゴリに加えて、ユーザー自身でカテゴリを新規作成・編集・削除できます。Lucideの各種プリセットアイコンからお気に入りのものを設定可能です。
5. **ローカルバックアップ (AES暗号化) ＆ 復元**
   全データをバックアップする際、パスワードを指定して `crypto-js` によるAES暗号化ファイル（`.enc`）として安全にローカル保存できます。復元時にもパスワード認証を求めることで、機密性の高い社内情報や個人メモの漏洩を防ぎます（通常のJSONでの出力も可能）。
6. **PWA対応・ストレージ永続化**
   Vite PWAプラグインにより、スマートフォン・PCの「ホーム画面に追加（インストール）」が可能です。また、アプリ初回起動時に `navigator.storage.persist()` を要求し、意図しないキャッシュクリアやOSの自動削除から大切なIndexedDBデータを保護します。設定画面から永続化の稼働ステータスを確認できます。
7. **P2Pデバイス同期機能 (WebRTC)**
   PCとスマホ（例：iPhoneなど）の間で、自前サーバーを経由せず直接データを同期（マージ）できます。LWW (Last-Write-Wins) 戦略を採用し、新しい編集内容が自動的に優先されます。

---

## 🛠️ 技術スタックと構成

### フロントエンド
- **React 18** + **TypeScript**
- **Vite** (ビルドツール / 開発サーバー) + **@vitejs/plugin-basic-ssl** (ローカルHTTPS環境構築)
- **Vanilla CSS (CSS Modules)**: `flexbox` 使いの実装、`color-scheme` を活用したOSダークモード・ライトモードの自動適用
- **Lucide React**: クリーンでミニマルな軽量アイコン

### データベース (ローカル)
- **Dexie.js**: ブロックされない非同期処理と強力なReact Hooksを備えた、`IndexedDB` のラッパーライブラリ。すべてのCRUD操作と検索フィルターを処理します。

### P2P同期機能
- **[PeerJS](https://peerjs.com/)**: WebRTCの複雑な接続処理とシグナリングを隠蔽するライブラリ。デフォルト設定のクラウドシグナリングサーバーを使用しています（データ通信自体はP2Pで直接行われます）。
- **qrcode.react**: ホストデバイス側での接続IDのQRコード生成
- **@yudiel/react-qr-scanner**: ゲストデバイス側でのQRコード読み取り（モバイルのカメラアクセス）

---

## 🚀 ディレクトリ＆コンポーネント構成

```text
src/
├── App.tsx             # エントリポイント。Layoutを呼び出す
├── main.tsx            # Reactルートマウント
├── index.css           # グローバルCSSレイアウトとテーマ変数 (Notionライク)
├── components/         # UIコンポーネント群
│   ├── Layout.tsx      # 全体の枠組み、サイドバー・メインエリアの配置、状態管理の中心
│   ├── Sidebar.tsx     # 左側のナビゲーション、カテゴリ・新規作成ボタンUI
│   ├── EntryList.tsx   # メインエリアにエントリをカード状にマッピングするコンポーネント
│   ├── EntryEditor.tsx # エントリの作成・編集用モーダル
│   ├── SearchBar.tsx   # 検索入力欄
│   ├── SettingsModal.tsx # バックアップ/復元とカテゴリ管理を行う設定モーダル
│   ├── SyncModal.tsx   # P2P同期を制御するモーダル (ホスト/ゲスト切り替えUI内包)
│   └── DynamicIcon.tsx # 文字列から動的にLucideアイコンをレンダリングするヘルパー
├── db/
│   └── db.ts           # Dexie.js データベーススキーマとクラス定義
└── sync/
    └── syncManager.ts  # PeerJSを利用した接続ロジックと、Dexieのデータマージ処理(LWW)をカプセル化したクラス
```

---

## 📖 開発・起動手順

### 1. リポジトリのクローンとインストール
```bash
# プロジェクトフォルダの作成と移動 (環境によってはgit clone)
cd shadow_dex
npm install
```

### 2. ローカルサーバーの起動
```bash
npm run dev
```

起動後、ターミナルに表示される `https://localhost:5173/` などのURLをブラウザで開いてください。モバイル（スマホ実機でのWebRTCやカメラ機能のテスト）で確認したい場合は、同じWi-Fiネットワークに接続し、ターミナルに表示される `Network: https://192.168.x.x:5173/` にアクセスしてください。

> [!NOTE]
> 本プロジェクトでは `@vitejs/plugin-basic-ssl` を導入しており、ローカル開発環境でも自動的にHTTPSが有効になります（iOS等でWebRTCやカメラを機能させるためです）。ブラウザによっては自己署名証明書の警告が出ますが、ローカルテスト用途としてそのまま閲覧を進めて問題ありません。

### 3. 本番用ビルド（任意）
```bash
npm run build
```
コマンド実行後、`dist`フォルダに最適化された静的ファイルが出力されます。

---

## 📝 使い方ガイド

- **新規作成**: 左下の「＋ 新規作成」ボタンを押し、開いたモーダルでタイトル、カテゴリ、タグ、詳細を入力して保存します。
- **検索**: 上部の検索バーにキーワードを入力すると、登録済みデータの一覧がリアルタイムで絞り込まれます。
- **設定 / バックアップ**: サイドバー下の「⚙️ 設定 / バックアップ」から、データのJSONエクスポート・インポートや、任意のカテゴリ追加とアイコンの設定が可能です。また、現在のデータがブラウザの削除対象から保護されているか（ストレージ永続化）をステータス表示で確認できます。
- **PWA（アプリとしてインストール）**: ブラウザのメニューから「ホーム画面に追加（インストール）」を選択すると、単体のアプリのように独立したウィンドウで起動します。これによりストレージ永続化もより強力に働きやすくなります。
- **P2Pデバイス同期**:
  1. PCブラウザで「デバイス同期」を押し、「PC側 (QRを表示)」を選択して同期を開始します。
  2. スマホから同じURL（Network IP等）にアクセスし、「デバイス同期」→「スマホ側 (QRを読む)」を選択します。
  3. カメラが起動したら、PC画面のQRコードを読み取ります。自動で接続され、お互いのデータがマージ（同期）されます。
